!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).Godb=n()}(this,(function(){"use strict";function e(n){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function t(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var i=function(){function t(e,o,r){n(this,t),this.godb=e,this.name=o,this.schema=r?c({id:Number},r):{}}return o(t,[{key:"get",value:function(e){var n=this;return new Promise((function(t,o){n.godb.getDB((function(r){var a=Object.keys(e)[0],c=e[a];try{var i=r.transaction(n.name,"readonly").objectStore(n.name),s="id"===a?i.get(c):i.index(a).get(c);s.onsuccess=function(e){var n=e.target.result;t(n)},s.onerror=function(e){var n=e.target.error;o(n)}}catch(e){o(e)}}))}))}},{key:"add",value:function(e){var n=this;return new Promise((function(t,o){n.godb.getDB((function(r){try{var a=r.transaction(n.name,"readwrite").objectStore(n.name).add(e);a.onsuccess=function(e){var n=e.target.result;t(n)},a.onerror=function(e){var n=e.target.error;o(n)}}catch(e){console.error(e)}}))}))}},{key:"put",value:function(n){var t=this;return new Promise((function(o,r){t.godb.getDB((function(a){if(!n||"object"!==e(n))return r(new Error("Table.put() failed: data should be an object"));if(!n.id)return r(new Error("Table.put() failed: id is required in data"));try{var c=a.transaction(t.name,"readwrite").objectStore(t.name).put(n);c.onsuccess=function(e){var n=e.target.result;o(n)},c.onerror=function(e){var n=e.target.error;r(n)}}catch(e){r(e)}}))}))}},{key:"update",value:function(){}},{key:"delete",value:function(e){var n=this;return new Promise((function(t,o){n.godb.getDB((function(r){try{n.get(e).then((function(e){var a=r.transaction(n.name,"readwrite").objectStore(n.name).delete(e.id);a.onsuccess=function(){t()},a.onerror=function(e){var n=e.target.error;o(n)}}))}catch(e){o(e)}}))}))}},{key:"find",value:function(e){}},{key:"where",value:function(){}},{key:"consoleTable",value:function(){var e=this;return new Promise((function(n,t){e.godb.getDB((function(o){try{var r=[];o.transaction(e.name,"readonly").objectStore(e.name).openCursor().onsuccess=function(e){var t=e.target.result;t?(r.push(c({id:t.key},t.value)),t.continue()):(console.table(r),n())}}catch(e){t(e)}}))}))}}]),t}(),s=window,u=s.indexedDB||s.webkitIndexedDB||s.mozIndexedDB||s.msIndexedDB;return function(){function t(e,o){if(n(this,t),this.tables={},this._callbackQueue=[],this.name=e,this.schema=o||null,this.getDB(),o)for(var r in o)this.tables[r]=new i(this,r,o[r])}return o(t,[{key:"table",value:function(e){return this.tables[e]}},{key:"init",value:function(e){return e?this.idb?void 0:console.warn("Init failed: database is not opened yet"):console.warn("Init failed: schema is not provided")}},{key:"close",value:function(){this.idb?(this.idb.close(),this.idb=null,this._connection=null,this._closed=!0,console.log("Connection to '".concat(this.idb.name,"' is closed"))):console.warn("Unable to close: database is not opened")}},{key:"drop",value:function(){var n=this;return new Promise((function(t,o){n.close();var r=n.name,a=u.deleteDatabase(r);a.onsuccess=function(o){console.log("Local database '".concat(r,"' is successfully dropped!")),n.onClosed&&("function"==typeof n.onClosed?n.onClosed():console.warn("'onClosed' should be a function, not ".concat(e(n.onClosed)))),t(o)},a.onerror=function(e){var n=e.target.error,t=n.name,a=n.message;console.warn("Local database '".concat(r,"' deleting failed!          \n- ").concat(t,": ").concat(a)),o("".concat(t,": ").concat(a))}}))}},{key:"backup",value:function(){}},{key:"getDBState",value:function(){return this._closed?"closed":this.idb?"opened":this._connection?"connecting":"init"}},{key:"createTable",value:function(e,n){var t=this.idb;if(!t)return console.error("Create table '".concat(e,"' failed: database is not opened"));if(!t.objectStoreNames.contains(e)){var o=t.createObjectStore(e,{keyPath:"id",autoIncrement:!0});for(var r in console.log("Table['".concat(e,"'] created in Database['").concat(t.name,"']")),n){var a=!!n[r].unique;o.createIndex(r,r,{unique:a}),console.log("Key['".concat(r,"'] created in Table['").concat(e,"'], Database['").concat(t.name,"']"))}}}},{key:"getDB",value:function(n){var t=this;return{closed:function(){console.warn("getDB failed: database is closed")},opened:function(){n&&"function"==typeof n&&n(t.idb)},connecting:function(){n&&"function"==typeof n&&t._callbackQueue.push(n)},init:function(){var n=t.name,o=t.schema;t._connection=u.open(n),t._connection.onsuccess=function(o){var r,a=(t._connection||o.target).result;t.idb||(t.idb=a,console.log("Database '".concat(n,"' existed with version (").concat(a.version,")"))),console.log("Local database '".concat(n,"' is opened!")),null!==(r=t._callbackQueue)&&void 0!==r&&r.length&&t._callbackQueue.forEach((function(e){return e(t.idb)})),t.onOpened&&("function"==typeof t.onOpened?t.onOpened(t.idb):console.warn("'onOpened' should be a function, not ".concat(e(t.onOpened))))},t._connection.onupgradeneeded=function(e){var r=e.oldVersion,a=e.newVersion,c=e.target;if(t.idb=c.result,console.log("Database '".concat(n,"' version changed from (").concat(r,") to (").concat(a,")")),0===r&&a>0)for(var i in console.log("Database '".concat(n,"' created with version (").concat(a,")")),o)t.createTable(i,o[i]);else a>0&&0===a?console.warn("Current opening database '".concat(n,"' was dropped")):r>0&&a>0&&console.log("Database '".concat(n,"' was upgraded"))},t._connection.onerror=function(e){var t=e.target.error,o=t.name,r=t.message;throw Error("Local database '".concat(n,"' opening failed!            \n- ").concat(o,": ").concat(r))},t._connection.onblocked=function(e){var t=e,o=t.newVersion,r=t.oldVersion;throw Error("Database '".concat(n,"' is opening somewhere with version (").concat(r,")            thus new opening request to version (").concat(o,") is failed."))}}}[this.getDBState()]()}}]),t}()}));
